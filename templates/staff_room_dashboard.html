{% extends 'base.html' %}
{% block title %}Room Management Dashboard | ABS{% endblock %}

{% block content %}
<main class="min-h-screen bg-gray-50 py-10">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        
        <div class="flex flex-col md:flex-row md:items-center justify-between mb-8 border-b pb-6 border-gray-200">
            <div>
                <h1 class="text-3xl font-serif text-slate-900">Study Suite <span class="text-gold">Command Center</span></h1>
                <p class="text-gray-500 text-sm mt-1">Live oversight of all 70 suites and student occupants.</p>
            </div>
            
            <div class="flex gap-4 mt-4 md:mt-0">
                <div class="bg-white px-6 py-3 rounded-xl shadow-sm border-t-4 border-green-500 text-center">
                    <span class="block text-xs text-gray-400 uppercase font-bold tracking-wider">Available</span>
                    <span class="text-2xl font-black text-slate-800">{{ available_count }}</span>
                </div>
                <div class="bg-white px-6 py-3 rounded-xl shadow-sm border-t-4 border-red-500 text-center">
                    <span class="block text-xs text-gray-400 uppercase font-bold tracking-wider">Occupied</span>
                    <span class="text-2xl font-black text-slate-800">{{ occupied_count }}</span>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-2 sm:grid-cols-4 md:grid-cols-7 lg:grid-cols-10 gap-3">
            {% for room in rooms %}
            <div class="relative group">
                <div class="p-4 rounded-lg border-2 text-center transition-all duration-200 shadow-sm
                    {% if room.is_available %}
                        bg-white border-gray-100 hover:border-gold
                    {% else %}
                        bg-slate-900 border-slate-900 text-white
                    {% endif %}">
                    
                    <span class="block text-sm font-bold uppercase">{{ room.name|slice:"6:" }}</span>
                    <span class="text-[9px] opacity-60">Floor {{ room.floor }}</span>
                    
                    {% if not room.is_available %}
                    <span class="block mt-1 text-[8px] font-bold text-red-400">BOOKED</span>
                    {% else %}
                    <span class="block mt-1 text-[8px] font-bold text-green-500">OPEN</span>
                    {% endif %}
                </div>

                {% if not room.is_available %}
                <div class="absolute z-50 invisible group-hover:visible opacity-0 group-hover:opacity-100 transition-all duration-300 bottom-full left-1/2 -translate-x-1/2 mb-3 w-64 bg-white p-5 rounded-xl shadow-2xl border border-gray-100 text-left">
                    <h4 class="text-slate-900 font-bold border-b pb-2 mb-3 text-sm flex justify-between">
                        Occupant Details 
                        <span class="text-gold text-xs">Room {{ room.name|slice:"6:" }}</span>
                    </h4>
                    
                    {% for booking in active_bookings %}
                        {% if booking.room.id == room.id %}
                        <div class="space-y-2 text-[13px]">
                            <p class="flex justify-between"><strong class="text-gray-400">ID:</strong> <span class="text-slate-800 font-medium">{{ booking.student_id }}</span></p>
                            <p class="flex justify-between"><strong class="text-gray-400">Email:</strong> <span class="text-slate-800 font-medium lowercase truncate ml-2">{{ booking.email }}</span></p>
                            <p class="flex justify-between"><strong class="text-gray-400">Phone:</strong> <span class="text-slate-800 font-medium">{{ booking.phone_number }}</span></p>
                            <p class="flex justify-between"><strong class="text-gray-400">Slot:</strong> <span class="text-slate-800 font-medium">{{ booking.time_slot }}</span></p>
                        </div>
                        
                        <hr class="my-3 border-gray-100">
                        
                        <a href="{% url 'programs:release_room' room.id %}" 
                           class="block w-full text-center py-2 bg-red-50 text-red-600 text-xs font-bold rounded-lg hover:bg-red-600 hover:text-white transition-colors"
                           onclick="return confirm('Release this room for other students?')">
                            Check-Out Student
                        </a>
                        {% endif %}
                    {% endfor %}
                    
                    <div class="absolute -bottom-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-white border-r border-b border-gray-100 rotate-45"></div>
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </div>
</main>
{% endblock %}